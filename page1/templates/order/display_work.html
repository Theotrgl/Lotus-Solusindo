{% extends 'base.html' %}

<html>
  <head>
    {% block title %}Work Data Table{% endblock %}
  </head>

  <body>
    {% block content %}
    <h1>Work Order List</h1>
    <table
      id="workTable"
      class="table table-bordered table-striped w-100 table-responsive-lg"
    >
      <thead class="thead-light">
        <tr>
          <th>Customer</th>
          <th>Item</th>
          <th>Revenue PO</th>
          <th>Nomor PO</th>
          <th>Tanggal PO</th>
          <th>Tanggal Proses</th>
          <th>Tanggal Input Accurate</th>
          <th>Tanggal Pengiriman Barang</th>
          <th>Tanggal Pengiriman Invoice</th>
          <th>Status</th>
          <th>Edit/Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for work in entities %}
        <tr>
          <td>{{ work.customer }}</td>
          <td>{{ work.item }}</td>
          <td>{{ work.revenue_PO }}</td>
          <td>{{ work.nomor_PO }}</td>
          <td>{{ work.tanggal_PO }}</td>
          <td>{{ work.tanggal_process }}</td>
          <td>{{ work.tanggal_input_accurate }}</td>
          <td>{{ work.tanggal_pengiriman_barang }}</td>
          <td>{{ work.tanggal_pengiriman_invoice }}</td>
          <td>{{ work.status }}</td>
          <td>
            <a href="{% url 'work_detail' work.id %}">View</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <script>
      new DataTable("#workTable", {
        columnDefs: [
          {
            targets: 2, // Target the first column (adjust the index as needed)
            render: function (data, type, row) {
              if (type === "display") {
                if (data.startsWith("IDR")) {
                  // Replace commas with periods and periods with commas
                  data = data
                    .replace(/,/g, "#")
                    .replace(/\./g, ",")
                    .replace(/#/g, ".");
                  data = data.substr(0, 3) + " " + data.substr(3);
                  return data;
                } else if (data.startsWith("$")) {
                  data = data.replace("$", "USD");
                  data = data.substr(0, 3) + " " + data.substr(3);
                  return data;
                } else {
                  // Add a space after the first three characters
                  return data.substr(0, 3) + " " + data.substr(3);
                }
              }
              return data;
            },
          },
        ],
        initComplete: function () {
          this.api()
            .columns()
            .every(function () {
              let column = this;
              let title = column.footer().textContent;

              // Create input element
              let input = document.createElement("input");
              input.placeholder = title;
              column.footer().replaceChildren(input);

              // Event listener for user input
              input.addEventListener("keyup", () => {
                if (column.search() !== this.value) {
                  column.search(input.value).draw();
                }
              });
            });
        },
        lengthMenu: [
          [10, 25, 50, 100, -1],
          [10, 25, 50, 100, "All"],
        ],
        layout: {
          top2Start: {
            buttons: {
              buttons: [
                { extend: "pdf", className: "btn-primary" },
                { extend: "csv", className: "btn-secondary" },
                { extend: "colvis", className: "btn-info" },
              ],
              dom: {
                button: {
                  className: "btn",
                },
              },
            },
          },
          // top2Start:'pageLength'
        },
      });
    </script>
    <a href="/add_WO">Add Work Order</a>
    {% endblock %}
  </body>
</html>
